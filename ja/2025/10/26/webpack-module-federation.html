<!doctype html><html lang="ja"><head><meta charset="utf-8"><title>Webpack モジュール連携</title><meta name="author" content="柳葉刀とコード"><meta name="keywords" content="Webpack, モジュール連携, マイクロフロントエンド, 共有依存関係, Webpack 5, 設定ガイド"><meta name="description" content="Webpackモジュール連携(Module Federation)の詳細なチュートリアル。概念の解説、動作原理、ホストアプリケーションとリモートアプリケーションの設定例、よくある質問を含み、マイクロフロントエンドアーキテクチャにおける依存関係の共有を実装するための開発者向けガイド。"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="alternate" href="https://liuzane.github.io/en" hreflang="en"><link rel="alternate" href="https://liuzane.github.io/zh" hreflang="zh"><link rel="alternate" href="https://liuzane.github.io/ja" hreflang="ja"><link rel="alternate" href="https://liuzane.github.io" hreflang="x-default"><link rel="canonical" href="https://liuzane.github.io/ja/2025/10/26/webpack-module-federation.html"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/article.css"></head><body><div id="container"><div id="nav" class="frosted-glass fade-in"><nav id="nav-wrap"><a class="nav-link" href="/ja">ホーム</a> <a class="nav-link" href="/ja/archives">アーカイブ</a> <a class="nav-link" href="/ja/categories">カテゴリ</a> <a class="nav-link" href="/ja/works">作品</a> <a class="nav-link" href="/ja/about">紹介</a></nav><div id="nav-lang"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="970" width="1.2rem" height="1.2rem"><path d="M1011.712 399.9744A512.1536 512.1536 0 0 0 512 0C229.2224 0 0 229.2224 0 512c0 282.7264 229.2224 512 512 512s512-229.2736 512-512c0-38.4512-4.2496-75.9808-12.288-112.0256zM94.976 512c0-52.1216 9.5744-101.9392 27.0336-147.968 22.1184 12.544 51.8656 14.848 51.8656 39.7824 0 82.432 3.072 170.8032 82.1248 172.1856 2.2528 0 44.032 15.0528 64 64 6.8608 16.896 34.1504 0 64 0 14.8992 0 0 23.808 0 75.264 0 51.3536 116.6848 130.304 116.6848 130.304-0.512 33.9456 0.9216 61.44 3.8912 83.3536a417.024 417.024 0 0 1-409.6-416.9216z m518.144 404.6336c16.4352-66.4064 24.4224-103.5776 58.7776-131.7888 49.664-40.8576 5.888-86.2208-31.8976-80.896-29.7984 4.3008-10.9568-34.9696-37.5808-37.12-26.624-2.0992-61.2864-52.224-99.584-69.4784-20.2752-9.1648-40.2432-33.6384-71.5264-34.7136-27.7504-1.024-68.2496 22.2208-68.2496 4.3008 0-57.7024-6.144-98.9184-7.424-115.3536-1.024-13.2096-9.1136-4.4544 28.3648-3.584 20.3776 0.512 10.4448-38.8608 30.6176-40.3968 19.8656-1.4848 67.072 17.6128 79.1552 9.984 11.2128-7.0656 82.2272 176.7936 82.2272 30.4128 0-17.408-9.472-47.616 0-64 37.5296-65.024 72.704-117.9648 69.5296-125.7472-1.792-4.352-38.4-7.936-67.6864 1.3824-9.8816 3.072 3.1232 17.7664-11.0592 20.9408-53.1968 11.6224-100.1984-13.6192-83.7632-37.376 16.896-24.2688 77.9264-10.5472 83.3024-59.3408 3.072-27.904 5.632-60.2624 7.3216-84.3264a417.536 417.536 0 0 1 326.4 259.584c-141.9776 103.424-105.6256 175.616-58.9824 216.8832 24.576 21.7088 47.9232 54.3744 63.1808 77.824a417.8944 417.8944 0 0 1-291.1232 262.8096z" p-id="971"></path></svg></div><div id="nav-lang-list" class="hidden"><a class="lang-link" href="/en/2025/10/26/webpack-module-federation.html" hreflang="en">English</a> <a class="lang-link" href="/zh/2025/10/26/webpack-module-federation.html" hreflang="zh">简体中文</a> <a class="lang-link" href="/ja/2025/10/26/webpack-module-federation.html" hreflang="ja">日本語</a></div></div><div id="scroller" class="fade-in"><div id="wrapper"><header id="header" class="frosted-glass"><div class="header-wrapper"><img src="/images/aodamiao.jpg" alt="柳葉刀とコード" class="header-avatar"><p class="header-author">柳葉刀とコード</p><p class="header-description">日々精進、向上心を忘れず</p></div></header><section id="content"><article class="article"><a class="article-back" href="javascript: history.back(-1)">&lt; 戻る</a><header class="article-header"><h1 class="article-title">Webpack モジュール連携</h1><div class="article-meta"><time datetime="2025-10-26T09:51:17.000Z" class="article-date">2025-10-26</time></div></header><div class="article-content"><p>最近、Webpackモジュール連携（Module Federation）をいじってみたので、苦闘の記録を残しておきます。</p><h3 id="Webpackモジュール連携（Module-Federation）とは"><a href="#Webpackモジュール連携（Module-Federation）とは" class="headerlink" title="Webpackモジュール連携（Module Federation）とは"></a>Webpackモジュール連携（Module Federation）とは</h3><p>Webpackモジュール連携はWebpack 5で追加された機能で、あるWebpackアプリケーションのモジュールを他のアプリケーションで使用できるようにします。</p><p>わかりやすく言うと、<strong>マイクロフロントエンドシステムに3つのアプリケーションがある場合、それらが同じreact&#x2F;vueバージョンを共有でき、ブラウザが依存パッケージを重複してダウンロードする問題を減らせます。</strong></p><h3 id="モジュール連携の仕組み"><a href="#モジュール連携の仕組み" class="headerlink" title="モジュール連携の仕組み"></a>モジュール連携の仕組み</h3><p>モジュール連携は2つの部分で構成されます：</p><ol><li>ホストアプリケーション（Host Application）：他のアプリケーションのモジュールを読み込みます。</li><li>リモートアプリケーション（Remote Application）：ホストアプリケーションが使用するモジュールを提供します。</li></ol><p>ホストアプリケーションは起動時に、リモートアプリケーションが提供するモジュールに遭遇すると、JavaScriptを通じてそのモジュールを読み込みます。読み込みが完了すると、Webpackはそのモジュール内の共有依存パッケージが既に読み込まれているかどうかを判断します：</p><ul><li>共有依存パッケージがまだ読み込まれていない場合、リモートアプリケーションはまず共有依存パッケージを要求し、読み込みが完了すると「読み込み済み」としてマークします。</li><li>共有依存パッケージが既に読み込まれている場合は、再度要求しません。</li></ul><p>フローチャートは以下の通りです：</p><p><img src="/images/guides/webpack-module-federation/ja.jpg" alt="マイクロフロントエンドモジュール連携フローチャート"></p><p>図を見たところで、コードを見せてください。。。</p><h3 id="Webpackモジュール連携設定説明"><a href="#Webpackモジュール連携設定説明" class="headerlink" title="Webpackモジュール連携設定説明"></a>Webpackモジュール連携設定説明</h3><p>Webpack設定を見ると頭が痛くなりますか？でも、まだ頭を痛めないでください。この後にもっと頭が痛くなることが待っていますから。。。😏</p><figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// モジュール連携プラグインはインストール不要です。Webpack 5に組み込まれています。</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ModuleFederationPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>).<span class="property">container</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// アプリケーション名。ホストアプリケーションがリモートアプリケーションのモジュールを参照する際に使用します。</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;&#123;appName&#125;&#x27;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// リモートアプリケーションのエントリーファイル名。他のアプリケーションがこのアプリケーションのモジュールを読み込む際に使用します。</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;remoteEntry.js&#x27;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ホストアプリケーションの設定。どのリモートアプリケーションのモジュールを読み込むかを指定します。</span></span><br><span class="line">      <span class="attr">remotes</span>: &#123;</span><br><span class="line">        <span class="comment">// keyはホストアプリケーションでのimport名、valueはリモートアプリケーションのエントリーファイルアドレスです。</span></span><br><span class="line">        <span class="attr">remote1</span>: <span class="string">&#x27;&#123;appName&#125;@http://localhost:&#123;port&#125;/&#123;filename&#125;.js&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// valueはPromiseコードでも構いません。</span></span><br><span class="line">        <span class="attr">remote2</span>: <span class="string">`promise new Promise((resolve) =&gt; &#123;</span></span><br><span class="line"><span class="string">          // ここで実行時にリモートモジュールのエントリーファイルアドレスを動的に決定できます。</span></span><br><span class="line"><span class="string">          const remoteUrl = getRemoteUrlFromSomewhere(); // カスタムロジック</span></span><br><span class="line"><span class="string">          const container = await import(/* webpackIgnore:false */ remoteUrl);</span></span><br><span class="line"><span class="string">          container.init(__webpack_share_scopes__.default); // 共有スコープを初期化</span></span><br><span class="line"><span class="string">          resolve(container);</span></span><br><span class="line"><span class="string">        &#125;)`</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// リモートアプリケーションの設定。ホストアプリケーションにどのモジュールを公開するかを指定します。</span></span><br><span class="line">      <span class="comment">// リモートアプリケーションは少なくとも1つのモジュールを公開する必要があります。そうでないとリモートアドレスを公開できず、</span></span><br><span class="line">      <span class="comment">// 共有依存機能も使用できません。</span></span><br><span class="line">      <span class="attr">exposes</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;./remoteModule1&#x27;</span>: <span class="string">&#x27;./src/remoteModule1.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;./remoteModule2&#x27;</span>: <span class="string">&#x27;./src/remoteModule2.js&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 共有依存設定。宣言方法は3つあります：</span></span><br><span class="line">      <span class="comment">// 1. 配列形式：バージョンはpackage.jsonから推測され、バージョンチェックはありません。常に見つかった高いバージョンを使用します。</span></span><br><span class="line">      <span class="attr">shared</span>: [<span class="string">&#x27;lodash&#x27;</span>],</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. 簡易オブジェクト形式：バージョンはpackage.jsonから推測されます。最高のlodashバージョン、つまり&gt;= 4.17 and &lt; 5を使用します。</span></span><br><span class="line">      <span class="attr">shared</span>: &#123;</span><br><span class="line">        <span class="attr">lodash</span>: <span class="string">&#x27;^4.17.0&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 詳細オブジェクト形式：共有依存の動作を制御するためのより多くのオプションを設定できます。</span></span><br><span class="line">      <span class="attr">shared</span>: &#123;</span><br><span class="line">        <span class="comment">// 共有依存ライブラリの名前。</span></span><br><span class="line">        <span class="attr">lodash</span>: &#123;</span><br><span class="line">          <span class="comment">// この依存関係を共有スコープ内で単一バージョンのみとするかどうか。デフォルトはfalse。</span></span><br><span class="line">          <span class="comment">// React、Vueなどのグローバル依存ライブラリの場合、singletonをtrueに設定する必要があります。</span></span><br><span class="line">          <span class="comment">// これにより、この依存関係を使用するすべてのアプリケーションが同じインスタンスを使用するようになります。</span></span><br><span class="line">          <span class="attr">singleton</span>: boolean,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// パッケージに必要なバージョン。デフォルトはfalse。</span></span><br><span class="line">          <span class="comment">// &#x27;^2.0.0&#x27;を設定すると、リモートアプリケーションが使用するlodashバージョンは2.0.0以上3.0.0未満でなければなりません。</span></span><br><span class="line">          <span class="attr">requiredVersion</span>: string | <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// リモートモジュールを読み込む際、この共有依存を即時に読み込むかどうか。デフォルトはfalse。</span></span><br><span class="line">          <span class="comment">// trueに設定すると、webpackは共有依存のパッケージをアプリケーションのバンドルに含めます。</span></span><br><span class="line">          <span class="comment">// 使用時に要求するのではなく。</span></span><br><span class="line">          <span class="attr">eager</span>: boolean,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// ローカルフォールバック依存の読み込み。デフォルトは現在の依存ライブラリ名、つまり &#x27;lodash&#x27;。</span></span><br><span class="line">          <span class="comment">// 文字列（依存ライブラリ名）に設定すると、Webpackは共有スコープから共有依存の読み込みを試みます。</span></span><br><span class="line">          <span class="comment">// 共有スコープ内に共有依存が見つからないか、バージョンが無効な場合、Webpackはローカルで共有依存を読み込むようにフォールバックします。</span></span><br><span class="line">          <span class="comment">// falseに設定すると、Webpackはローカル依存を読み込まず、共有スコープからのみ読み込みます。</span></span><br><span class="line">          <span class="attr">import</span>: <span class="literal">false</span> | string,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 厳密なバージョンチェック。デフォルトはtrue。</span></span><br><span class="line">          <span class="comment">// ローカルフォールバック依存が利用可能で、共有依存のsingletonがfalseの場合、</span></span><br><span class="line">          <span class="comment">// リモートアプリケーションが使用するlodashバージョンは共有スコープ内のものと一致しなければなりません。</span></span><br><span class="line">          <span class="attr">strictVersion</span>: boolean,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 提供される依存関係のバージョン。デフォルトはfalse。</span></span><br><span class="line">          <span class="comment">// これにより、webpackは一致する低いバージョンを置き換えることができますが、一致する高いバージョンは置き換えられません。</span></span><br><span class="line">          <span class="attr">version</span>: <span class="literal">false</span> | string,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 共有スコープ内の共有依存のキー名。デフォルトは依存ライブラリ名、つまり &#x27;lodash&#x27;。</span></span><br><span class="line">          <span class="comment">// このキー名に基づいて共有スコープから要求された共有依存を検索します。</span></span><br><span class="line">          <span class="comment">// 異なるキー名に設定することで、同じ依存ライブラリの異なるバージョンを各アプリケーションに適用できます。</span></span><br><span class="line">          <span class="attr">shareKey</span>: string,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 共有スコープの名前。デフォルトは &#x27;default&#x27;。</span></span><br><span class="line">          <span class="comment">// ホストアプリケーションとリモートアプリケーションは、異なる共有スコープ名を設定できます。</span></span><br><span class="line">          <span class="comment">// これにより、異なるアプリケーション間の共有依存の衝突を避けられます。</span></span><br><span class="line">          <span class="attr">shareScope</span>: string,</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 依存関係名。</span></span><br><span class="line">          <span class="attr">packageName</span>: string,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><ol><li>共有依存設定は、ホストアプリケーションとリモートアプリケーションの両方で宣言されなければ、共有依存機能は有効になりません。</li><li>ホストアプリケーションまたはリモートアプリケーションのいずれかで共有依存を設定しても、共有依存パッケージをインストールする必要がなくなるわけではありません（<code>import</code>が<code>false</code>に設定されている場合を除く、非推奨）。</li><li>ホストアプリケーションとリモートアプリケーションが共有依存を要求する際、共有依存が利用できないかバージョンが一致しない場合、ローカルのフォールバック依存が読み込まれます。</li><li>ホストアプリケーションもリモートアプリケーションになり得ます。自身のモジュールを公開することで、他のアプリケーションはホストアプリケーションのモジュールを読み込めます。</li></ol></blockquote><p><a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/module-federation-plugin/#Options">Webpackモジュール連携設定公式ドキュメント</a></p><p>設定説明を読んだので、すべての共有依存設定オプションを知っているはずです。どれだけ理解したか見てみましょう。😎</p><h3 id="ホストアプリケーション設定"><a href="#ホストアプリケーション設定" class="headerlink" title="ホストアプリケーション設定"></a>ホストアプリケーション設定</h3><figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ModuleFederationPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>).<span class="property">container</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;host&#x27;</span>,</span><br><span class="line">      <span class="attr">remotes</span>: &#123;</span><br><span class="line">        <span class="attr">remote1</span>: <span class="string">&#x27;remote1@http://localhost:5001/remoteEntry.js&#x27;</span>,</span><br><span class="line">        <span class="attr">remote2</span>: <span class="string">&#x27;remote2@http://localhost:5002/remoteEntry.js&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">shared</span>: &#123;</span><br><span class="line">        <span class="attr">lodash</span>: &#123; </span><br><span class="line">          <span class="attr">singleton</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">requiredVersion</span>: <span class="string">&#x27;2.0.0&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>main.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;./bootstrap&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>bootstrap.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 何らかのコード...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;remote1/remoteModule&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; bootstrap, hello &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">bootstrap</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">hello</span>());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 何らかのコード...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;remote2/remoteModule&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; bootstrap, hello &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">bootstrap</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">hello</span>());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 何らかのコード...</span></span><br></pre></td></tr></table></figure><p>これを見て、きっと困惑しているでしょう。なぜルートディレクトリに<code>bootstrap.js</code>ファイルが追加されているのか？なぜ<code>main.js</code>で<code>bootstrap.js</code>ファイルをインポートしているのか？<br>これは無駄なことをしているのではないか？<br>答えは実はノーです。公式ドキュメントではこう述べています：</p><blockquote><p>アプリケーションは、グローバルホストとして実行されるアプリケーションを熱心に実行しています。非同期境界（asynchronous boundary）の使用を強く推奨します。これにより、初期化コードが大きなチャンクに分離され、追加のオーバーヘッドを回避し、全体的なパフォーマンスが向上します。<a target="_blank" rel="noopener" href="https://webpack.js.org/concepts/module-federation/#uncaught-error-shared-module-is-not-available-for-eager-consumption">クリックして表示</a></p></blockquote><p>つまり、非同期境界がなく、<code>eager: true</code>が有効になっていない場合、ホストアプリケーションはすぐにlodashなどの共有依存パッケージを読み込もうとします。しかし、<code>eager: false</code>の場合、依存パッケージは非同期で読み込まれるため、ホストアプリケーションは共有依存パッケージが利用できないというエラーをスローします。</p><h3 id="リモートアプリケーション設定"><a href="#リモートアプリケーション設定" class="headerlink" title="リモートアプリケーション設定"></a>リモートアプリケーション設定</h3><blockquote><p>リモートアプリケーションは複数存在できます。ホストアプリケーションは<code>remote1</code>と<code>remote2</code>の2つのアドレスを設定しています。ここでは<code>remote1</code>の設定のみを示します。<code>remote2</code>も同様です。</p></blockquote><figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ModuleFederationPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>).<span class="property">container</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/bootstrap.js&#x27;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;remote1&#x27;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;remoteEntry.js&#x27;</span>,</span><br><span class="line">      <span class="attr">exposes</span>: &#123;</span><br><span class="line">        <span class="string">&quot;./remoteModule&quot;</span>: <span class="string">&quot;./src/exposes.js&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">shared</span>: &#123;</span><br><span class="line">        <span class="attr">lodash</span>: &#123; </span><br><span class="line">          <span class="attr">singleton</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">requiredVersion</span>: <span class="string">&#x27;2.0.0&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>exposes.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">bootstrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;./bootstrap&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;Hello Remote1&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>bootstrap.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 何らかのコード...</span></span><br></pre></td></tr></table></figure><p>リモートアプリケーションの設定はホストアプリケーションとは異なります：まず、リモートアプリケーションを起動し、特定のモジュールを外部に公開する必要があります。その後、Webpackモジュール連携はそのリモートモジュールのアクセスアドレスを生成します。このアドレスをホストアプリケーションのモジュール連携設定に構成し、ホストアプリケーションを起動すると、ホストアプリケーションが<code>import(&#39;remote1/remoteModule&#39;)</code>のようなコードを実行する際、Webpackモジュール連携コンテナはそのアドレスを通じてリモートモジュールを読み込みます。同時に、そのリモートモジュールが宣言する共有依存が現在の共有スコープに既に存在するかどうかをチェックします。依存関係が利用できないか、バージョンに互換性がない場合、モジュール連携は自動的にホストアプリケーションのローカルフォールバック依存の読み込みにフォールバックします。</p><p><a href="https://liuzane.github.io/webpack-module-federation-demo">デモ オンラインデモ</a><br><a target="_blank" rel="noopener" href="https://github.com/liuzane/webpack-module-federation-demo">デモ Github コード</a></p><h3 id="疑問と回答"><a href="#疑問と回答" class="headerlink" title="疑問と回答:"></a>疑問と回答:</h3><ol><li><p><strong>質問</strong>: <strong>ホストアプリケーションとリモートアプリケーションの両方が共有依存lodashを設定していますが、ホストとリモートのlodashバージョンが一致しません。何が起こりますか？</strong><br><strong>回答</strong>: バージョンが一致しない場合、<code>requiredVersion</code>は共有スコープ内のバージョンが要求バージョン範囲を満たしているかどうかをチェックします。満たしていない場合、ローカルのフォールバック依存が読み込まれます。</p></li><li><p><strong>質問</strong>: <strong><code>singleton</code>設定オプションの目的は何ですか？また、バージョン交渉メカニズムはどのように機能しますか？</strong><br><strong>回答</strong>: <code>singleton</code>は、この依存関係を共有スコープ内で単一バージョンとして共有するかどうかを指定するために使用されます。<code>true</code>に設定すると、共有スコープ内に存在できるバージョンは1つだけです。異なるバージョンの共有依存が複数存在する場合、Webpackはバージョン交渉メカニズムを使用します（共有依存の最も高いバージョンを使用しようとします。低いバージョンを設定したアプリケーションが先に読み込まれても、最も高いバージョンが使用されます）。そして、<code>singleton: true</code>が設定されているすべてのアプリケーションにそのバージョンの使用を強制します。<br>lodashを例に挙げます：</p><figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">/* App1 */</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">lodash</span>: &#123;</span><br><span class="line">  <span class="attr">singleton</span>: <span class="literal">true</span>, <span class="comment">// シングルトン固有バージョン</span></span><br><span class="line">  <span class="attr">requiredVersion</span>: <span class="string">&#x27;^1.0.0&#x27;</span>, <span class="comment">// 1.0.0以上2.0.0未満</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">/* App2 */</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">lodash</span>: &#123;</span><br><span class="line">  <span class="attr">singleton</span>: <span class="literal">true</span>, <span class="comment">// シングルトン固有バージョン</span></span><br><span class="line">  <span class="attr">requiredVersion</span>: <span class="string">&#x27;^2.0.0&#x27;</span>, <span class="comment">// 2.0.0以上3.0.0未満</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">/* App3 */</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">lodash</span>: &#123;</span><br><span class="line">  <span class="attr">singleton</span>: <span class="literal">false</span>, <span class="comment">// 非シングルトンバージョン</span></span><br><span class="line">  <span class="attr">requiredVersion</span>: <span class="string">&#x27;^3.0.0&#x27;</span>, <span class="comment">// 3.0.0以上4.0.0未満</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>App1はシングルトン固有バージョンを使用し、lodashバージョンが<strong>1.0.0以上2.0.0未満</strong>であることを要求します。<br>App2はシングルトン固有バージョンを使用し、lodashバージョンが<strong>2.0.0以上3.0.0未満</strong>であることを要求します。<br>App3はシングルトン固有バージョンを使用せず、lodashバージョンが<strong>3.0.0以上4.0.0未満</strong>であることを要求します。<br>すると、どちらが先に読み込まれても、App1とApp2はApp2で設定された最高バージョン<code>2.0.0</code>を使用します。App3のlodashは、使用可能なバージョンが見つからず、<code>singleton</code>が<code>false</code>に設定されているため、ローカルのフォールバックバージョン<code>3.0.0</code>を使用します。</p></li><li><p><strong>質問</strong>: <strong>リモートアプリケーションは共有依存を使用したいだけで、自身のモジュールを公開するシナリオがありません。そのため、<code>shared</code>のみを設定し、<code>exposes</code>を設定していません。何が起こりますか？</strong><br><strong>回答</strong>: リモートアプリケーションのリモートモジュールURLは生成されません。ホストアプリケーションがそのリモートモジュールURLにアクセスすると404エラーが返され、モジュール連携は有効になりません。常に自身のフォールバック依存のみを読み込みます。</p></li><li><p><strong>質問</strong>: <strong>ホストアプリケーションはlodashをインストールし、共有依存を設定しています。リモートアプリケーションはnpm依存パッケージをインストールせずに、共有依存のみを設定できますか？</strong><br><strong>回答</strong>: はい、できますが推奨されません。ホストアプリケーションとリモートアプリケーションの両方がlodashを共有依存として設定しているが、リモートアプリケーションがnpm依存パッケージをインストールしていない場合、リモートアプリケーションは次のように設定する必要があります：</p><figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">lodash</span>: &#123;</span><br><span class="line">  <span class="attr">import</span>: <span class="literal">false</span>, <span class="comment">// ローカルフォールバック依存を読み込まず、共有スコープからのみ読み込む。</span></span><br><span class="line">  <span class="attr">singleton</span>: <span class="literal">true</span>, <span class="comment">// シングルトン固有バージョン</span></span><br><span class="line">  <span class="attr">requiredVersion</span>: <span class="string">&#x27;*&#x27;</span>, <span class="comment">// 任意のバージョン</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ただし、これは推奨されません。ネットワークやその他の理由でホストアプリケーションのlodashバージョンの読み込みに失敗した場合、リモートアプリケーションはエラーをスローし、ローカルフォールバック依存を使用しないためです。</p></li><li><p><strong>質問</strong>: <strong>ホストアプリケーション設定では、リモートモジュールを動的インポート<code>import(&#39;&#123;remotesKey&#125;/&#123;exposesKey&#125;&#39;)</code>でインポートする必要がありますか？他の方法でインポートできますか？</strong><br><strong>回答</strong>: この方法でインポートする必要があります。HTMLインポートなどの他の方法でもエラーが発生します。</p></li></ol></div><div class="comment-divider"></div><script src="https://giscus.app/client.js" data-lang="ja" data-repo="liuzane&#x2F;liuzane.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkyMTY3ODEyNDM&#x3D;" data-category="Announcements" data-category-id="DIC_kwDODOvRu84CwfsS" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" crossorigin="anonymous" async></script></article></section><footer id="footer" class="frosted-glass"><div class="footer-wrapper"><a href="/" class="footer-title">柳葉刀とコードのブログ</a><p>この小さな世界は私が作り上げたものだ。</p></div></footer></div></div><script src="/js/i18n.js"></script></div></body></html>